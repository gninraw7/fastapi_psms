# ì‹¤ì œ ìŠ¤í‚¤ë§ˆ ë°˜ì˜ ìˆ˜ì • ì‚¬í•­

## ğŸ“‹ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

### 1. FastAPI íŒŒì¼ (ì„œë²„ì¸¡)
- âœ… `app/schemas/project.py` - ë°ì´í„° ìŠ¤í‚¤ë§ˆ ìˆ˜ì •
- âœ… `app/services/project_service.py` - SQL ì¿¼ë¦¬ ìˆ˜ì •
- âœ… `app/api/v1/endpoints/projects/routes.py` - API ì—”ë“œí¬ì¸íŠ¸ íŒŒë¼ë¯¸í„° ìˆ˜ì •

### 2. VBA íŒŒì¼ (í´ë¼ì´ì–¸íŠ¸ì¸¡)
- âœ… `vba_modules/FrmProjectList_FastAPI.frm` - í•„ë“œëª… ë§¤ì¹­ ìˆ˜ì •

### 3. ë°ì´í„° íŒŒì¼
- âœ… `test_data_real_schema.sql` - ì‹¤ì œ ìŠ¤í‚¤ë§ˆ ê¸°ì¤€ í…ŒìŠ¤íŠ¸ ë°ì´í„°

---

## ğŸ”„ ì£¼ìš” ë³€ê²½ ì‚¬í•­

### ë°ì´í„°ë² ì´ìŠ¤ í•„ë“œëª… ë§¤í•‘

#### ê¸°ì¡´ (ê°€ìƒ ìŠ¤í‚¤ë§ˆ) â†’ ì‹¤ì œ (DB ìŠ¤í‚¤ë§ˆ)

| êµ¬ë¶„ | ê¸°ì¡´ í•„ë“œëª… | ì‹¤ì œ í•„ë“œëª… | ì„¤ëª… |
|------|------------|------------|------|
| **í”„ë¡œì íŠ¸** | customer_name | customer_name (JOIN) | clients í…Œì´ë¸” ì¡°ì¸ |
| | field | field_code | ì‚¬ì—…ë¶„ì•¼ ì½”ë“œ |
| | - | field_name | ì‚¬ì—…ë¶„ì•¼ ëª…ì¹­ (ì½”ë“œ ì¡°ì¸) |
| | stage | current_stage | í˜„ì¬ ì§„í–‰ ë‹¨ê³„ |
| | - | stage_name | ë‹¨ê³„ ëª…ì¹­ (ì½”ë“œ ì¡°ì¸) |
| | amount | quoted_amount | ì œì•ˆ ê¸ˆì•¡ |
| | probability | (ì‚­ì œ) | ì‹¤ì œ ìŠ¤í‚¤ë§ˆì— ì—†ìŒ |
| | expected_date | (ì‚­ì œ) | ì‹¤ì œ ìŠ¤í‚¤ë§ˆì— ì—†ìŒ |
| **ì¶”ê°€** | - | ordering_party_name | ë°œì£¼ì²˜ëª… |
| | - | contract_date | ê³„ì•½ì¼ |
| | - | start_date | ìˆ˜í–‰ ì‹œì‘ì¼ |
| | - | end_date | ìˆ˜í–‰ ì¢…ë£Œì¼ |
| | - | contract_amount | ê³„ì•½ ê¸ˆì•¡ |
| | - | order_amount | ìˆ˜ì£¼ ê¸ˆì•¡ |

### API íŒŒë¼ë¯¸í„° ë³€ê²½

#### í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ (GET /api/v1/projects/list)

**ê¸°ì¡´:**
```
?page=1&page_size=25&stage=PROPOSAL&manager=user01
```

**ë³€ê²½:**
```
?page=1&page_size=25&current_stage=PROPOSAL&manager_id=user01&field_code=SI
```

| íŒŒë¼ë¯¸í„° | ê¸°ì¡´ | ë³€ê²½ | ë¹„ê³  |
|---------|-----|------|------|
| stage | âœ“ | â†’ current_stage | í•„ë“œëª… ë³€ê²½ |
| manager | âœ“ | â†’ manager_id | í•„ë“œëª… ë³€ê²½ |
| field_code | âœ— | âœ“ ì¶”ê°€ | ì‚¬ì—…ë¶„ì•¼ í•„í„° |
| search_field | FIELD | project_name, customer_name | ê²€ìƒ‰ ëŒ€ìƒ ëª…í™•í™” |

---

## ğŸ’¾ SQL ì¿¼ë¦¬ ë³€ê²½

### í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ ì¿¼ë¦¬

**ê¸°ì¡´ (ë‹¨ìˆœ ì¿¼ë¦¬):**
```sql
SELECT 
    p.pipeline_id,
    p.project_name,
    p.customer_name,
    p.field,
    p.stage,
    p.manager_id,
    u.user_name as manager_name,
    p.amount
FROM projects p
LEFT JOIN users u ON p.manager_id = u.login_id
```

**ë³€ê²½ (ì‹¤ì œ ìŠ¤í‚¤ë§ˆ - ë‹¤ì¤‘ JOIN):**
```sql
SELECT 
    p.pipeline_id,
    p.project_name,
    p.field_code,
    cc_field.code_name as field_name,
    p.current_stage,
    cc_stage.code_name as stage_name,
    p.manager_id,
    u.user_name as manager_name,
    c1.client_name as customer_name,
    c2.client_name as ordering_party_name,
    p.quoted_amount,
    pc.contract_date,
    pc.start_date,
    pc.end_date,
    pc.order_amount,
    pc.contract_amount
FROM projects p
LEFT JOIN users u ON p.manager_id = u.login_id
LEFT JOIN clients c1 ON p.customer_id = c1.client_id
LEFT JOIN clients c2 ON p.ordering_party_id = c2.client_id
LEFT JOIN project_contracts pc ON p.pipeline_id = pc.pipeline_id
LEFT JOIN comm_code cc_field ON p.field_code = cc_field.code AND cc_field.group_code = 'FIELD'
LEFT JOIN comm_code cc_stage ON p.current_stage = cc_stage.code AND cc_stage.group_code = 'STAGE'
```

### ë‹´ë‹¹ì ì¡°íšŒ ì¿¼ë¦¬

**ë³€ê²½:**
```sql
SELECT 
    login_id, 
    user_name,
    department,  -- ì¶”ê°€
    team         -- ì¶”ê°€
FROM users
WHERE is_sales_rep = 1  -- ê¸°ì¡´: > 0
  AND status = 'ACTIVE'
  AND (end_date IS NULL OR end_date >= CURDATE())  -- í‡´ì‚¬ì ì œì™¸
```

---

## ğŸ¯ VBA ì½”ë“œ ì£¼ìš” ë³€ê²½

### LoadGridData() í•¨ìˆ˜

**íŒŒë¼ë¯¸í„° êµ¬ì„± ë³€ê²½:**
```vba
' ê¸°ì¡´
params("stage") = cmbStage.Value
params("manager") = cmbManager.Value

' ë³€ê²½
params("current_stage") = cmbStage.Value
params("manager_id") = cmbManager.Value
params("field_code") = cmbField.Value
```

**ê·¸ë¦¬ë“œ ì…€ í• ë‹¹ ë³€ê²½:**
```vba
' ê¸°ì¡´
.CellValue(rowIndex, "field") = GetValue(item, "field")
.CellValue(rowIndex, "stage") = GetValue(item, "stage")
.CellValue(rowIndex, "amount") = GetValue(item, "amount")

' ë³€ê²½
.CellValue(rowIndex, "field_code") = GetValue(item, "field_code")
.CellValue(rowIndex, "field_name") = GetValue(item, "field_name")
.CellValue(rowIndex, "current_stage") = GetValue(item, "current_stage")
.CellValue(rowIndex, "stage_name") = GetValue(item, "stage_name")
.CellValue(rowIndex, "quoted_amount") = GetValue(item, "quoted_amount")
.CellValue(rowIndex, "contract_amount") = GetValue(item, "contract_amount")
.CellValue(rowIndex, "ordering_party_name") = GetValue(item, "ordering_party_name")
```

---

## ğŸ“ í…ŒìŠ¤íŠ¸ ë°ì´í„°

`test_data_real_schema.sql` íŒŒì¼ì— ë‹¤ìŒ ë°ì´í„° í¬í•¨:

- âœ… ê³µí†µì½”ë“œ: FIELD (5ê±´), STAGE (8ê±´)
- âœ… ì‚¬ìš©ì: 5ëª… (ì˜ì—…ëŒ€í‘œ 3ëª… í¬í•¨)
- âœ… ê³ ê°ì‚¬: 15ê°œ íšŒì‚¬
- âœ… í”„ë¡œì íŠ¸: 15ê±´ (KBê·¸ë£¹ 7ê±´, ê³µê³µ 3ê±´, ëŒ€ê¸°ì—… 5ê±´)
- âœ… ê³„ì•½ ì •ë³´: 3ê±´
- âœ… ë§¤ì¶œ ì‹¤ì : 16ê±´
- âœ… ë³€ê²½ ì´ë ¥: 5ê±´

---

## ğŸš€ ì ìš© ë°©ë²•

### 1. ì„œë²„ ì¤‘ì§€
```cmd
# ì‹¤í–‰ ì¤‘ì¸ FastAPI ì„œë²„ì—ì„œ Ctrl+C
```

### 2. íŒŒì¼ êµì²´
- ìˆ˜ì •ëœ Python íŒŒì¼ë“¤ì„ ê¸°ì¡´ íŒŒì¼ê³¼ êµì²´
- ê¸°ì¡´ `test_data.sql` â†’ `test_data_real_schema.sql` ì‚¬ìš©

### 3. í…ŒìŠ¤íŠ¸ ë°ì´í„° ì…ë ¥
```sql
-- MySQLì— ì ‘ì†í•˜ì—¬ ì‹¤í–‰
source test_data_real_schema.sql;
-- ë˜ëŠ”
mysql -h mysql-klcube-erp-klcube-erp.l.aivencloud.com -P 14724 -u your_user -p defaultdb < test_data_real_schema.sql
```

### 4. ì„œë²„ ì¬ì‹œì‘
```cmd
python main.py
```

### 5. API í…ŒìŠ¤íŠ¸
ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8000/docs ì ‘ì†í•˜ì—¬:
- `GET /api/v1/projects/list` í…ŒìŠ¤íŠ¸
- `GET /api/v1/projects/combo/FIELD` í…ŒìŠ¤íŠ¸
- `GET /api/v1/projects/managers` í…ŒìŠ¤íŠ¸

### 6. VBA ì½”ë“œ ì ìš©
- Excel VBA í¸ì§‘ê¸°ì—ì„œ ê¸°ì¡´ `FrmProjectList` ì½”ë“œë¥¼
- `FrmProjectList_FastAPI.frm` ë‚´ìš©ìœ¼ë¡œ êµì²´

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### iGrid ì»¬ëŸ¼ëª… ë³€ê²½ í•„ìš”
VBA UserFormì˜ iGrid ì»¨íŠ¸ë¡¤ì—ì„œ ë‹¤ìŒ ì»¬ëŸ¼ë“¤ì„ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤:

**ê¸°ì¡´ ì»¬ëŸ¼:**
- `field`, `stage`, `amount`, `probability`, `expected_date`

**ìƒˆë¡œìš´ ì»¬ëŸ¼:**
- `field_code`, `field_name`, `current_stage`, `stage_name`, `quoted_amount`, `contract_amount`, `ordering_party_name`, `contract_date`, `start_date`, `end_date`

### users í…Œì´ë¸” is_sales_rep í•„ë“œ
- ê¸°ì¡´: `is_sales_rep > 0`
- ë³€ê²½: `is_sales_rep = 1` (TINYINT(1)ë¡œ ì •ì˜ë¨)

### ë‚ ì§œ í•„í„°ë§
- users í…Œì´ë¸”ì— `end_date` í•„ë“œ ì¶”ê°€ë¡œ í‡´ì‚¬ì ìë™ ì œì™¸

---

## ğŸ” ê²€ì¦ ë°©ë²•

### 1. API ì‘ë‹µ í™•ì¸
```json
{
  "total_records": 15,
  "current_page": 1,
  "page_size": 25,
  "items": [
    {
      "pipeline_id": "2024_001",
      "project_name": "KBêµ­ë¯¼ì€í–‰ ì°¨ì„¸ëŒ€ ì‹œìŠ¤í…œ êµ¬ì¶•",
      "field_code": "SI",
      "field_name": "ì‹œìŠ¤í…œí†µí•©(SI)",
      "current_stage": "NEGOTIATION",
      "stage_name": "í˜‘ìƒ",
      "customer_name": "KBêµ­ë¯¼ì€í–‰",
      "ordering_party_name": "KBêµ­ë¯¼ì€í–‰",
      "quoted_amount": 5000000000.00
    }
  ]
}
```

### 2. VBA í…ŒìŠ¤íŠ¸
```vb
' VBA ì¦‰ì‹œ ì‹¤í–‰ ì°½
? ModFastAPI.TestConnection()
' â†’ "FastAPI ì„œë²„ ì—°ê²° ì„±ê³µ!" ë©”ì‹œì§€ í™•ì¸

' í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸
Set params = CreateObject("Scripting.Dictionary")
params("page") = 1
params("page_size") = 10
Set result = ModFastAPI.HttpGet("/projects/list", params)
? result("total_records")
' â†’ 15 ì¶œë ¥
```

---

## ğŸ“ ë¬¸ì œ í•´ê²°

### Q: ë°ì´í„°ê°€ ì¡°íšŒë˜ì§€ ì•ŠìŒ
A: 
1. test_data_real_schema.sqlì´ ì •ìƒ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸
2. comm_code í…Œì´ë¸”ì— FIELD, STAGE ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
3. projects í…Œì´ë¸”ì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸

### Q: JOIN ì˜¤ë¥˜ ë°œìƒ
A: 
1. clients í…Œì´ë¸”ì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
2. users í…Œì´ë¸”ì— ì˜ì—…ëŒ€í‘œ(is_sales_rep=1) ë°ì´í„° ìˆëŠ”ì§€ í™•ì¸

### Q: VBAì—ì„œ í•„ë“œëª… ì˜¤ë¥˜
A: 
1. iGrid ì»¨íŠ¸ë¡¤ì˜ ì»¬ëŸ¼ëª…ì´ ì‹¤ì œ ìŠ¤í‚¤ë§ˆì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
2. CellValue() í• ë‹¹ ì‹œ í•„ë“œëª… í™•ì¸
